<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>PXN CB1 Keymap Editor</title>

<style>
body{
    background:#111;
    font-family:Segoe UI;
    color:white;
    text-align:center;
}

/* ================= ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ ================= */

.keyboard-container{
    position:relative;
    margin:auto;
    width:420px;
    height:760px;
    background:url("pxn_cb1.png") no-repeat center;
    background-size:contain;
}

.key{
    position:absolute;
    background:rgba(0,0,0,.55);
    border:2px solid #444;
    border-radius:10px;
    display:flex;
    align-items:center;
    justify-content:center;
    cursor:pointer;
    font-size:12px;
    transition:.1s;
}

.key:hover{
    border-color:#00d4ff;
}

.key.selected{
    border-color:#00ff88;
    box-shadow:0 0 10px #00ff88;
}

/* ================= UI ================= */

.panel{
    margin:15px auto;
}

input{
    padding:6px;
    width:200px;
}

button{
    padding:6px 12px;
    margin:4px;
}
</style>
</head>

<body>

<h2>ğŸ® PXN CB1 Keymap Editor</h2>

<div class="panel">
    ãƒ¬ã‚¤ãƒ¤ãƒ¼:
    <button onclick="prevLayer()">â—€</button>
    <span id="layerLabel">0</span>
    <button onclick="nextLayer()">â–¶</button>
</div>

<div class="keyboard-container" id="keyboard"></div>

<div class="panel">
    ã‚­ãƒ¼ã‚³ãƒ¼ãƒ‰:
    <input id="keyInput" oninput="updateKey(this.value)">
</div>

<div class="panel">
    <button onclick="downloadKeymap()">keymap.c ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
    <button onclick="saveLocal()">ä¿å­˜</button>
    <button onclick="loadLocal()">èª­è¾¼</button>
</div>

<script>

/* ==========================
   ğŸ”´ CB1 ã‚­ãƒ¼é…ç½®ï¼ˆpxå˜ä½ï¼‰
   å¿…è¦ã«å¿œã˜ã¦å¾®èª¿æ•´ã—ã¦ãã ã•ã„
========================== */

const layout = [

/* ä¸Šæ®µãƒãƒ– */
{id:0,x:55,y:35,w:60,h:60},
{id:1,x:155,y:35,w:60,h:60},
{id:2,x:255,y:35,w:110,h:60},

/* ãƒœã‚¿ãƒ³ç¾¤ */
{id:3,x:45,y:135,w:80,h:70},
{id:4,x:135,y:135,w:80,h:70},
{id:5,x:45,y:215,w:80,h:70},
{id:6,x:135,y:215,w:80,h:70},
{id:7,x:45,y:295,w:80,h:70},
{id:8,x:135,y:295,w:80,h:70},
{id:9,x:45,y:375,w:80,h:70},
{id:10,x:135,y:375,w:80,h:70},

/* ä¸­å¤®ãƒ­ã‚´ */
{id:11,x:235,y:180,w:150,h:120},

/* ä¸‹ãƒãƒ– */
{id:12,x:270,y:360,w:90,h:90}
];


/* ==========================
   çŠ¶æ…‹
========================== */

let layers=[{}];
let currentLayer=0;
let selected=null;

const keyboard=document.getElementById("keyboard");


/* ==========================
   æç”»
========================== */

function render(){

keyboard.innerHTML="";

layout.forEach(k=>{

    const el=document.createElement("div");
    el.className="key";

    el.style.left=k.x+"px";
    el.style.top=k.y+"px";
    el.style.width=k.w+"px";
    el.style.height=k.h+"px";

    el.textContent = layers[currentLayer][k.id] || "";

    if(selected===k.id) el.classList.add("selected");

    el.onclick=()=>{
        selected=k.id;
        document.getElementById("keyInput").value =
            layers[currentLayer][k.id]||"";
        render();
    };

    keyboard.appendChild(el);
});

document.getElementById("layerLabel").textContent=currentLayer;

}


/* ==========================
   ã‚­ãƒ¼æ›´æ–°
========================== */

function updateKey(v){
    if(selected==null)return;
    layers[currentLayer][selected]=v;
    render();
}


/* ==========================
   ãƒ¬ã‚¤ãƒ¤ãƒ¼
========================== */

function nextLayer(){
    currentLayer++;
    if(!layers[currentLayer]) layers[currentLayer]={};
    render();
}

function prevLayer(){
    currentLayer=Math.max(0,currentLayer-1);
    render();
}


/* ==========================
   ä¿å­˜/èª­è¾¼
========================== */

function saveLocal(){
    localStorage.setItem("cb1map",JSON.stringify(layers));
    alert("ä¿å­˜ã—ã¾ã—ãŸ");
}

function loadLocal(){
    const d=localStorage.getItem("cb1map");
    if(d){
        layers=JSON.parse(d);
        render();
    }
}


/* ==========================
   keymap.c å‡ºåŠ›
========================== */

function downloadKeymap(){

let txt="const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {\n";

layers.forEach((l,i)=>{
    txt+=`[${i}] = LAYOUT(\n`;

    const arr=[];
    layout.forEach(k=>{
        arr.push(l[k.id]||"KC_NO");
    });

    txt+=arr.join(", ")+"\n),\n";
});

txt+="};";

const blob=new Blob([txt]);
const a=document.createElement("a");
a.href=URL.createObjectURL(blob);
a.download="keymap.c";
a.click();
}


/* ==========================
   åˆæœŸæç”»
========================== */

render();

</script>
</body>
</html>
